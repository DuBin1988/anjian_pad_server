1. 测试准备

1.1 在数据库里清除所有用户档案，抄表记录，交费记录。

delete from t_userfiles;
delete from t_sellinggas;
delete from t_handplan;

1.2 将用户编号预设为11000000

update t_singlevalue set value=0 where name='西安奥枫软件有限公司用户编号'

1.3 将民用临界气量设置为50方
1.4 将临界内气价设为1.1元
1.5 将临界外气价设为1.98元

update t_singlevalue set value=1.98 where name='临界外气价'

2. 建立档案

2.1 气表类型选择机表，用户姓名输入test1。
2.2 气表指数默认为0，余额默认为0，保存。
2.3 保存后，用户编号为11000000。

3. 抄表录入

3.1 进入抄表录入界面，输入11000000，找出用户test1。
3.2 上次抄表底数0，本次抄表底数录入12方，本月用气量12方，本月用气金额应当为13.20元，上期余额和本期余额都为0。
3.3 保存。
3.4 查询抄表信息，有一笔抄表记录，状态是已抄表，未交费。

4. 机表交费

4.1 进入交费界面，输入11000000，找出用户test1。
4.2 上次抄表底数0，本次抄表底数录入12方，本月用气量12方，本月用气金额应当为13.20元，应交费金额为13.2元。
4.3 录入交费金额30.5元，本期结余应当为17.3元。
4.4 查询交费信息，有一笔交费信息，为有效。

5. 继续抄表（自动下账）

5.1 在左侧输入test1，查找出用户11000000
5.2 上次指数应当为12，录入本次指数25，本次气量应当为13，用气金额应当为14.30元。
5.3 上次结余应当为17.3元，本次结余应当为3元，应当产生自动下账记录，保存。
5.4 提交。在交费记录里查询，应当有2笔交费记录，都有效，有一笔类型为“余存交费”。
5.5 查询用户档案，账户余额3。

6. 抄表撤销（带自动下帐撤销）

6.1 在抄表撤销里输入test1，找出用户11000000。
6.2 核对上次指数12，本次指数25，本次气量13，金额14.3。上期结余17.3，本期结余3。
6.3 输入撤销原因：有自动下账记录撤销
6.4 提交。
6.5 在交费记录里查询，交费类型为“余存交费”应当为无效。
6.6 在抄表录入里面的上次抄表底数变成12。
6.7 查询用户档案，账户余额为17.3。

7. 继续抄表

7.1 输入test1，找出用户11000000。
7.2 上次抄表底数应当为12，录入本次抄表底数32，本次用气量应当为20，本次用气金额应当为22.00元。
7.3 此时不应产生自动下账记录，上期结余应当为17.3，本期结余依旧为17.3元。
7.4 提交。
7.5 在抄表记录里查询，此时应当有2笔抄表记录，状态为都是已抄表，一笔为已缴费，一笔为未交费。

8. 继续交费

8.1 在交费界面里用姓名test1找出用户11000000。
8.2 上次抄表底数应当为12，录入本次抄表底数32，本次用气量应当为20，本次用气金额应当为22.00元。
应交费金额为4.7元，收款金额录入4.7，此时上次结余17.3,本期结余0。
8.3 保存。
8.4 查询缴费记录，有3笔交费记录，2笔有效，1笔无效（余存交费）。
8.5 在用户档案里查询，看最新账户结余是否为0。

9. 交费撤销

9.1 在交费撤销里输入test1，找出用户11000000。
9.2 核对上次抄表底数应当为12，录入本次抄表底数32，本次用气量应当为20，本次用气金额应当为22.00元。
应交费金额为4.7元，收款金额录入4.7，此时上次结余17.3,本期结余0。
9.3 录入撤销原因：正常交费撤销
9.4 提交。
9.5 查询交费记录，应当有两笔无效记录，一笔有效记录。

10. 继续抄表

10.1 输入用户名test1，从左边选择出用户。
10.2 上次指数应当为32，本次抄表底数84，本月用气量52，临界内金额55，临界外金额3.96，本月用气总金额58.96。
10.3 上期余额17.3，本期余额17.3。在抄表信息里面没有自动下账。
10.4 保存。
10.5 查看抄表信息，有三笔抄表信息，状态都是已抄表，一笔交费，2笔未交费。

11. 抄表撤销

11.1 在抄表撤销里输入test1，找出用户11000000。
11.2 核对上次指数32，本次指数84，临界内气量50，临界外气量2，本月用气总量52。临界内金额55，临界外金额3.96，本月用气总金额58.96，上期余额和本期余额17.3。
11.3 输入撤销原因：没有自动下账记录撤销。
11.3 提交。
11.4 在交费记录里查询，还是3笔，1笔有效，2笔无效。
11.5 在用户档案中查询11000000，找出用户，查看账户余额还是17.3。
11.6 在抄表信息中查询，有三笔抄表记录，2笔为已抄表，一笔为未抄表。

12. 重复撤销

12.1 在抄表撤销里输入test1，找出用户11000000。
12.2 此时应该提示，抄表记录为未抄表，不能撤销。

13. 继续抄表

13.1 输入test1，找出用户11000000。
13.2 上次指数应当为32，录入本次指数85，本次用气量应当为53，临界内气量50，临界外气量3，临界内金额55，临界外金额5.94，本月用气总金额60.94。
上期结余17.3，本期结余17.3，不产生下账记录。
13.3 提交。
13.4 在抄表记录中查询，此时应该有3笔抄表记录，都是已抄表，有两笔是未交费，1笔交费。

14. 机表交费

14.1 在交费界面里用姓名test1找出用户11000000。
14.2 上次抄表底数12，本次抄表85，总用气量73，用气金额82.94，应交金额65.64。
14.3 先交第一笔抄表记录的费用22，输入收款金额40，应交金额4.7，本期结余35.3，上期结余17.3。提交。
14.4 查询机表交费信息，有4笔交费记录，2笔有效，2笔无效。
14.5 查询用户档案，账户余额35.3。

15. 机表交费撤销

15.1 在交费撤销里输入test1，找出用户11000000。
15.2 核对上次指数12，本次指数32，用气总量20，用气总金额22，收款金额40，应交金额4.7，本期结余35.3，上期结余17.3。
15.2 冲正原因：正常交费撤销。
15.3 提交。
15.4 查询机表交费记录，有4笔交费记录，3笔无效记录，1笔有效记录。
15.5 查询用户档案，账户余额17.3。

16. 机表交费，全交

16.1 在交费界面里输入test1，找出用户11000000
16.2 上次抄表底数12，本次抄表底数85，总用气量73，用气金额82.94，应交65.64，上期结余17.3。
16.3 收款金额录入80，上期结余17.3，本期结余14.36。
16.4 提交。
16.5 查询机表交费记录，有5笔交费记录，3笔无效记录，2笔有效记录。
16.6 查询用户档案，账户余额14.36。

17. 抄表撤销，已缴费不能撤销

17.1 在抄表撤销里输入test1，找出用户11000000。
17.2 上次抄表底数32，本次抄表底数85，总用气量53，本月用气金额60.94。
上期结余17.3，本期结余17.3。
17.3 应当提示已缴费，不能撤销。

18. 已缴费的抄表撤销

18.1 在机表冲正里输入test1，找出用户11000000。
18.2 核对上次抄表底数12，本次抄表85，总用气量73，用气金额82.94，应交金额65.64，收款金额80，上期余额17.3，本期余额14.36。
18.3 填写冲正原因，正常交费撤销。
18.4 然后保存。
18.5 查询售气收费信息，有5笔交费记录，4笔无效记录，1笔有效记录。
18.6 查询用户档案，账户余额17.3。

19.抄表撤销

19.1 抄表撤销，输入test1，找出用户11000000。
19.2 上期抄表指数32，本期抄表指数85，本月用气量53，临界内金额55，临界外金额5.94，本月用气金额60.94。
19.3 填写撤销原因：已缴费冲正后的抄表撤销。
19.4 然后保存。
19.5 查询机表抄表信息，有3条抄表记录，2个已抄表记录，1个未抄表记录。

20. 抄表录入，不能下账

20.1 输入test1，找出用户11000000。
20.2 上期抄表底数32，本次抄表底数100，不下账，临界内金额55，临界外金额35.64，本月用气金额90.64，本期结余17.3，上期结余17.3。
20.3 提交. 
20.4 查询机表收费记录，5笔收费记录，1笔有效记录，4笔无效记录。
20.5 查询机表抄表信息，3笔抄表记录，都是已抄表，1笔交费，2笔未交费。

21. 抄表录入，够下账，不下账

21.1 输入test1，找出用户11000000。
21.2 上期抄表底数是100，本次抄表底数是102，不下账。本月用气量2，本月用气金额2.20，本期结余17.3，上期结余17.3。
21.3 提交。
21.4 查询售气收费信息，5笔收费记录，1笔有效记录，4笔无效记录。
21.5 查询机表抄表信息，4笔抄表记录，都为已抄表，1笔交费，3笔未交费。

22. 机表交费，全交

22.1 找到用户test1，找出用户11000000。
22.2 有三笔要交费的记录，上次抄表底数12，本次抄表底数102。
22.3 本月用气量90，本月用气金额114.84，应交金额97.54，录入收款金额120，上期结余17.3，本期结余22.46。
22.4 查询用户档案，账户余额22.46。
22.5 查询交费记录，6笔收费记录，2笔有效记录，4笔无效记录。

23. 抄表录入，够下账，下账

23.1 输入test1，找出用户11000000。
23.2 上期抄表底数102，输入本期抄表底数103，本月用气量1，本月用气金额1.10。上期结余22.46，本期结余21.36。
23.3 提交。
23.4 查询交费记录，7笔收费记录，3笔有效记录，4笔无效记录。
23.5 查询用户档案，账户余额21.36。
23.6 查询抄表记录，5笔抄表记录，都为已抄表，都为已交费。
